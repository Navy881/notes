# Тестирование микросервисов

*Тестирование —* это процесс, проводимый в основном после разработки.

## Структура автоматического теста

Автоматические тесты обычно пишут, используя специальный фреймворк. Напри­мер, JUnit — популярный фреймворк тестирования для Java. Каждый тест реализуется в виде метода, который принадлежит тестовому классу.

Типичный автоматический тест состоит из четырех этапов:

1. *Подготовка* — инициализирует среду тестирования, состоящую из самой си­стемы и ее зависимостей, приводя ее в нужное состояние. Например, создает тестируемый класс и приводит его в состояние, необходимое для демонстрации желаемого поведения.
2. *Выполнение —* запускает тестируемую систему, например вызов метода из тести­руемого класса.
3. *Проверка —* делает выводы о результате выполнения и состоянии тестируемой системы. Например, проверяет значение, возвращаемое методом, и новое состоя­ние тестируемого класса.
4. *Очистка -* удаляет среду тестирования, если это необходимо. Многие тесты про­пускают этот этап, но, например, при тестировании БД иногда нужно откатить транзакции, инициированные на этапе подготовки.

![Untitled](%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2/Untitled.png)

Чтобы уменьшить дублирование кода и упростить тесты, в тестовый класс иногда добавляют подготовительные методы, которые выполняются перед вызовом самого теста, и методы очистки, реализуемые в самом конце. Тестовый *набор —* это перечень тестовых классов. Для их запуска используется *средство выполнения тестов.*

## Тестирование с помощью макетов и заглушек

Тестируемая система часто имеет зависимости, которые могут осложнить и замед­лить ваши тесты. Решение состоит в замене зависимостей тестируемой систе­мы дублерами. *Дублер —* это объект, который симулирует поведение зависимости. Существует два вида дублеров: 

- заглушки (stubs). *Заглушка —* это дублер, который возвращает значения тестируемой системе.
- макеты (mocks). *Макет —* это дублер, используемый тестом для проверки того, что тестируемая система корректно вы­зывает свои зависимости. Во многих случаях макет является заглушкой.

Эти термины часто считают взаимозаменяемыми, хотя они немного различаются. 

 

## Типы тестов

Четыре разных типов:

- *модульные тесты,* которые тестируют небольшую часть сервиса, такую как класс;
- *интеграционные тесты,* которые проверяют, может ли сервис взаимодействовать с инфраструктурными компонентами, такими как базы данных и другие сервисы приложения;
- *компонентные тесты —* приемочные тесты для отдельного сервиса;
- *сквозные тесты —* приемочные тесты для целого приложения.

Они различаются в основном охватом. На одном конце спектра находятся мо­дульные тесты, которые проверяют поведение наименьшего значимого элемента программы. В объектно-ориентированных языках, таких как Java, это класс. Их про­тивоположность — сквозные тесты, проверяющие поведение целого приложения. Посередине находятся компонентные тесты, относящиеся к отдельным сервисам. Интеграционные тесты имеют относительно
небольшой охват, но они сложнее, чем обычные модульные тесты.

## Тестовый квадрант

Хороший способ классифицировать тесты — тестовый квадрант, предложенный Брайаном Мариком (Brian Marick). Он группирует тесты по двум основаниям.

- *К чему относится тест — к бизнесу или технологиям.* Бизнес-тест описывается в терминологии специалиста проблемной области, тогда как для описания тех­нологического теста используется терминология разработчиков и реализации.
- *Какова цель теста — помочь с написанием кода или дать оценку приложению.*Разработчики применяют тесты, которые помогают им в ежедневной работе. Тесты, оценивающие приложение, нужны для определения проблемных участков.

![Untitled](%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2/Untitled%201.png)

Тестовый квадрант определяет четыре категории тестов:

- *Q1* — помощь в программировании с ориентацией на технологии — модульные и интеграционные тесты;
- *Q2* — помощь в программировании с ориентацией на бизнес — компонентные и сквозные тесты;
- Q3 — оценка приложения с точки зрения бизнеса — проверка удобства исполь­зования и исследовательское тестирование;
- *Q4* — оценка приложения с точки зрения технологий — нефункциональное при­емочное тестирование, такое как проверка производительности.

## Пирамида тестов

Чтобы удостовериться, что наше приложение работает, мы должны написать разного рода тесты. Но проблема в том, что с увеличением охвата теста растут его сложность и время выполнения. Кроме того, чем шире охват теста и чем больше составных элементов он в себя включает, тем менее надежным становится. Ненадежные тесты не намного лучше, чем их отсутствие, ведь, если тесту нельзя доверять, его сбои, скорее всего, будут игнорироваться.

Поскольку наш бюджет на разработку и тестирование ограничен, мы хотим сосредоточиться на на­ писании тестов с небольшим охватом, не ставя при этом под угрозу эффективность тестового набора. Хорошим подспорьем в этом может стать пирамида тестов. В ее основании лежат быстрые, простые и надежные тесты. Сквозные тесты, отличающиеся низкой скоростью, высокой сложностью и нена­дежностью, расположены на вершине. Пирамида тестов описывает относительные пропорции каждого типа тестирования.

![Untitled](%D0%A2%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2/Untitled%202.png)

Суть этого подхода заключается в том, что с продвижением вверх по пирамиде мы должны писать все меньше и меньше тестов. Модульных тестов должно быть много, а сквозных — мало.

Сложность тестиро­вания — характеристика не столько отдельных сервисов, сколько взаимодействия между ними.