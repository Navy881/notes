# Deployment (Развертывание сервисов)

![Untitled](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Untitled.png)

# Развертывание микросервисов

*Развертывание —* это сочетание двух взаимосвязанных концепций — процесса и архитектуры. Процесс развертывания заключается в доставке кода в промышлен­ную среду и состоит из этапов, которые должны выполнить люди — разработчики или системные администраторы. Архитектура развертывания определяет структуру среды, в который этот код будет выполняться. С конца 1990-х годов, когда я начал писать промышленные Java-приложения, оба эти аспекта радикально изменились. Процесс перебрасывания разработчиками кода на рабочий сервер вручную стал высокоавтоматизированным. На смену физической промышленной среде пришла легковесная динамическая вычислительная инфраструктура.

![Untitled](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Untitled%201.png)

История:

- В 1990-е годы, если вы хотели развернуть приложение в промышленной среде, вам нужно было передать свой код вместе с набором инструкций по его обслужива­нию системным администраторам. Вы могли, к примеру, оформить заявку с прось­бой развернуть приложение. Все, что происходило после этого, ложилось на плечи администраторов, исключением были ситуации, когда обнаруживалась проблема, ко­торую нельзя было решить без вашей помощи. Обычно системные администраторы покупали и устанавливали дорогие и тяжеловесные серверы приложений, такие как WebLogic или WebSphere. Затем заходили в консоль этих серверов и развертывали ваш код. Они с любовью заботились об этих компьютерах, словно о собственных питомцах, устанавливая заплатки и обновляя программное обеспечение.
- В середине 2000-х на смену дорогим серверам приложений пришли открытые легковесные веб-контейнеры наподобие Apache Tomcat и Jetty. Теперь стало воз­можным выделять целый веб-контейнер лишь для одного приложения, хотя это не было обязательным требованием. Примерно в то же время вместо физического оборудования начали применять виртуальные машины. Но к серверам по-прежнему относились как к домашним животным, а развертывание, как и раньше, было прин­ципиально ручным процессом.
- В наши дни процесс развертывания выглядит совсем иначе. Вместо передачи кода отдельной команде системных администраторов используется концепция DevOps, согласно которой ответственность за развертывание приложений и сер­висов частично ложится и на разработчиков. В некоторых организациях адми­ нистраторы предоставляют разработчикам консоль для развертывания проектов. Но еще лучше, когда после прохождения тестов код автоматически доставляется в промышленную среду.
- Радикально изменились и вычислительные ресурсы, которые используются в промышленной среде. Вместо физических серверов мы имеем дело с виртуаль­ными машинами, запущенными в высокоавтоматизированных облаках наподобие AWS. Современные ВМ неизменяемы. Это уже не домашние любимцы, а безликие одноразовые сущности, которые легче удалить и воссоздать, чем конфигурировать заново. Все большую популярность набирают *контейнеры —* еще более легковесный слой абстракции поверх виртуальных машин. Дальнейшее развитие этой идеи — бессерверные платформы развертывания, такие как AWS Lambda, которые имеют множество сфер применения.

Эволюция процессов и архитектур развертывания не случайно происходит одно­временно с ростом популярности микросервисов. Приложение может состоять из десятков и сотен сервисов, написанных с помощью разных языков и фреймворков. Поскольку каждый сервис автономен, это означает, что в вашей промышленной сре­де могут находиться десятки и сотни программ. Конфигурацию серверов и сервисов больше не имеет смысла поручать администраторам. Если вы хотите развертывать свои микросервисы в крупных масштабах, вам необходимы высокоавтоматизиро­ванные процесс и инфраструктура.

На рис. 12.2 представлена обобщенная схема промышленной среды, которая позволяет разработчикам конфигурировать и администрировать свои сервисы, про­цессу развертывания — доставлять новые версии кода, а пользователям — получать доступ к возможностям, реализованным этими сервисами.

![Untitled](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Untitled%202.png)

Промышленная среда должна поддерживать четыре ключевые возможности.

- *Интерфейс управления сервисами* позволяет разработчикам создавать, обновлять и конфигурировать сервисы. В идеале это интерфейс REST API, с которым рабо­тают консольные и графические инструменты развертывания.
- *Управление запущенными сервисами* пытается следить за тем, чтобы в промыш­ленной среде всегда выполнялось желаемое количество экземпляров серви­са. Если экземпляр сервиса вышел из строя или по какой-то причине больше не может обслуживать запросы, промышленная среда должна его перезапустить.
Если отказал целый сервер, все его сервисы должны быть перезапущены на дру­гом компьютере.
- *Мониторинг* предоставляет разработчикам сведения о работе их сервисов, вклю­чая журнальные файлы и показатели. В случае возникновения проблем про­мышленная среда должна оповестить разработчиков.
- *Маршрутизация* направляет запросы от пользователей к сервисам.

В этой главе обсуждаются четыре основных варианта развертывания.

- Развертывание сервиса в виде пакетов для определенных языков, таких как JAR- или WAR-файлы в Java. Этот подход заслуживает внимания в качестве демонстрации недостатков, из-за которых я рекомендую использовать один из других вариантов.
- Применение виртуальных машин упрощает процесс развертывания, так как сервисы упаковываются в виде образов для ВМ (виртуальных машин), которые инкапсулируют их технологический стек.
- Развертывание сервисов в виде контейнеров, более легковесных по сравнению с виртуальными машинами. Например, с помощью популярного фреймворка для оркестрации Docker-контейнеров под названием Kubernetes.
- Бессерверное развертывание является даже более современным, чем контейнеры. Например, с помощью популярной бессерверной платформы AWS Lambda.

## Развертывание сервисов с помощью пакетов для отдельных языков

[**Multiple service instances per host (Несколько сервисов на одном сервере**)](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Multiple%20service%20instances%20per%20host%20(%D0%9D%D0%B5%D1%81%D0%BA%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE%20%D1%81%D0%B5%D1%80.md)

## Развертывание сервисов в виде виртуальных машин

[**Service instance per VM (Развёртывание сервиса в виде ВМ**)](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Service%20instance%20per%20VM%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%CC%88%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%20%D0%B2.md)

## Развертывание сервисов в виде контейнеров

[**Service instance per container (Развёртывание сервиса в виде контейнера**)](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Service%20instance%20per%20container%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%CC%88%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80.md)

## Развертывание приложения с помощью Kubernetes

[Kubernetes](../Kubernetes.md)

## Бессерверное развертывание сервисов

[**Serverless deployment (Бессерверное развертывание**)](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Serverless%20deployment%20(%D0%91%D0%B5%D1%81%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BD%D0%BE%D0%B5%20%D1%80%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5).md)

[**Service mesh (Сеть сервисов**)](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Service%20mesh%20(%D0%A1%D0%B5%D1%82%D1%8C%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2).md)

[**Sidercar (Прицеп**) ](Deployment%20(%D0%A0%D0%B0%D0%B7%D0%B2%D0%B5%D1%80%D1%82%D1%8B%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Sidercar%20(%D0%9F%D1%80%D0%B8%D1%86%D0%B5%D0%BF).md)