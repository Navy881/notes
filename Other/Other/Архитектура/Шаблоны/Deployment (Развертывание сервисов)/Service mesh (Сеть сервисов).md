# Service mesh (Сеть сервисов)

### Проблема

Вы должны реализовать множество сквозных задач, включая: 

- Внешняя конфигурация - включает учетные данные и сетевое расположение внешних сервисов, таких как базы данных и брокеры сообщений;
- Ведение журнала - настройка механизма ведения журнала, такого как log4j или logback;
- Проверка здоровья - url, который сервис мониторинга может "пинговать" для определения состояния приложения;
- Метрики - измерения, которые дают представление о том, что делает приложение и как оно работает;
- Распределенная трассировка - оснащение сервисов кодом, который присваивает каждому внешнему запросу уникальный идентификатор, передаваемый между сервисами.

Шасси микросервисов - хороший способ реализации универсальных функций, таких как предохранители. Однако для каждого языка программирования, который вы используете, требуется отдельное шасси. Например, Spring Boot и Spring Cloud подходят для разработчиков на Java/Spring, но они мало чем помогут, если вы пи­шете сервис на основе NodeJS.

### Решение

Используйте сеть сервисов, которая опосредует все коммуникации, входящие и выходящие из каждого сервиса.

Пропускает весь трафик между сервисами через сетевой слой, реализующий такие функции, как предохранители, распределённая трассировка, обнаружение сервисов, балансирование нагрузки, маршрутизация трафика с учётом правил.

У этого подхода появляется новая альтернатива, которая заключается в реали­зации этих функций в рамках так называемой сети сервисов. *Сеть сервисов —* это сетевая инфраструктура, которая служит промежуточным звеном между вашим сер­висом и другими внутренними и внешними компонентами. На рис. 11.17 показано, как весь входящий и исходящий трафик сервиса проходит через эту сеть, которая берет на себя функции:

- предохранителей;
- распределенной трассировки;
- обнаружения сервисов;
- балансирования нагрузки;
- маршрутизации трафика с учетом правил.

Сеть сервисов может также защищать межсервисное взаимодействие с помощью IPC на основе TLS. Благодаря этому больше не нужно реализовывать эти возмож­ности внутри сервисов.

![Untitled](Service%20mesh%20(%D0%A1%D0%B5%D1%82%D1%8C%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)/Untitled.png)

Использование сети сервисов значительно упрощает микросервисное шасси, которое в этом случае отвечает только за функции, глубоко интегрированные в код приложения, например за работу с внешней конфигурацией и проверку работоспо­собности. Микросервисное шасси также должно поддерживать распределенную трассировку путем распространения такой информации, как заголовки стандарта ВЗ.

Примеры реализаци сети сервисов:

- Istio ([https://istio.io/](https://istio.io/));
- Linkerd ([https://linkerd.io/](https://linkerd.io/));
- Conduit ([https://conduit.io/](https://conduit.io/)).

### Преимущества

- Освобождает разработчи­ка от реализации различных общих функций.
- Благодаря маршрутизации трафика вы можете отделить развертывание от выпуска обновлений.
- Позволяет развертывать новые версии в промышленной среде, делая их доступными только для некоторых пользователей, например для внутренней команды тестирования.

### Недостатки

-