# Interprocess communication (Межпроцессное взаимодействиe)

Важную роль в этой архитектуре играет межпроцессное взаимодействие (interprocess communication, IPC). 

Шаблоны взаимодействия, разделенные на пять групп:

- *Стиль взаимодействия.* Какой механизм IPC следует использовать?
- *Обнаружение.* Каким образом клиент сервиса узнает его IP-адрес, чтобы, напри­мер, выполнить НТТР-запрос?
- *Надежность.* Как обеспечить надежное взаимодействие между сервисами с уче­том того, что некоторые из них могут быть недоступны?
- *Транзакционный обмен сообщениями.* Как следует интегрировать отправку со­общений и публикацию событий с транзакциями баз данных, которые обновляют бизнес-информацию?
- *Внешний API.* Каким образом клиенты вашего приложения взаимодействуют с сервисами?

![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled.png)

![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled%201.png)

## **Cтили взаимодействия**

![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled%202.png)

Первый уровень опреде­ляет выбор между отношениями «один к одному» и «один ко многим»:

- *«один к одному»* — каждый клиентский запрос обрабатывается ровно одним сервисом;
- *«один ко многим» —* каждый запрос обрабатывается несколькими сервисами.

Второй уровень определяет выбор между синхронным и асинхронным взаимо­действием:

- *синхронное —* клиент рассчитывает на своевременный ответ от сервиса и может даже заблокироваться на время ожидания;
- *асинхронное* — клиент не блокируется, а ответ, если таковой придет, может быть отправлен не сразу.

Виды взаимодействия «один к одному».

- *Запрос/ответ* — клиент отправляет сервису запрос и ждет ответа. Он рассчи­тывает на то, что ответ придет своевременно, и может даже заблокироваться на время ожидания.
- *Асинхронный запрос/ответ —* клиент отправляет запрос, а сервис отвечает асин­хронно. Клиент не блокируется на время ожидания, поскольку сервис может долго не отвечать.
- *Однонаправленные уведомления —* клиент отправляет сервису запрос, не ожидая (и не получая) ничего в ответ.

Виды взаимодействия «один ко многим».

- *Издатель/подписчик —* клиент публикует сообщение с уведомлением, которое потребляется любым количеством заинтересованных сервисов.
- *Издатель/асинхронные ответы —* клиент публикует сообщение с запросом и ждет определенное время ответа от заинтересованных сервисов.

## Развитие API

**Семантическая нумерация версий**

- MAJOR — при внесении в API несовместимого изменения (указывается в URL);
- MINOR — при изменении API с сохранением обратной совместимости;
- PATCH — при исправлении ошибки с сохранением обратной совместимости.

**Выбор формата сообщений**

Текстовые форматы сообщений JSON и XML.
Недостаток применения текстовых форматов связан с тем, что сообщения полу­ чаются довольно объемными, особенно если речь идет об XML. Еще одной отрицательной стороной являются накладные расходы на разбор текста.

Двоичные форматы сообщений Protocol Buffers и Avro. 
Оба эти формата предоставляют типизированный язык IDL для описания структуры ваших сообщений. Затем компилятор генерирует код, который их сериализует и десериализует.

## Обнаружение сервисов

Сетевое местоположение назначается экземплярам сервисов динамически. Более того, набор этих экземпляров постоянно меняется из-за автоматического масшта­ бирования, отказов и обновлений. Из-за этого ваш клиент должен использовать обнаружение сервисов.

![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled%203.png)

**Механизмы обнаружения сервисов**
По своей сути обнаружение сервисов является довольно простым: его ключевым компонентом выступает реестр сервисов — база данных с информа­ цией о том, где находятся экземпляры сервисов приложения. Когда экземпляры сервисов запускаются и останавливаются, механизм обнару­жения обновляет реестр. 

Есть два основных способа реализации механизма обнаружения сервисов.

- Сервисы и их клиенты напрямую взаимодействуют с реестром.
Для вызова сервиса клиент сначала обращается к реестру, чтобы получить список его экземпляров, а затем шлет запрос одному из них.
    
    ![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled%204.png)
    
- За обнаружение сервисов отвечает инфраструктура развертывания.
Современные платформы развертывания, такие как Docker и Kubernetes, имеют встроенные реестр и механизм обнаружения сер­ висов. Платформа развертывания выдает каждому сервису DNS-имя, виртуальный IP-адрес (VIP) и привязанное к нему доменное имя. Клиент делает запрос к DNS-имени/VIP, а платформа развертывания автоматически направляет его к одному из доступных экземпляров сервиса. В итоге регистрация и обнаружение сервисов, а также маршрутизация запросов выполняются самой платформой.
    
    ![Untitled](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Untitled%205.png)
    

## Механизмамы IPC

**Communication style (Стили взаимодейтвия)**

[Remote Procedure Invocation (Удалённый вызов процедур)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Remote%20Procedure%20Invocation%20(%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%CC%88%D0%BD%D0%BD%D1%8B%D0%B8%CC%86%20%D0%B2%D1%8B%D0%B7%D0%BE%D0%B2%20%D0%BF%D1%80%D0%BE.md)

[Messaging (Обмен сообщениями)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Messaging%20(%D0%9E%D0%B1%D0%BC%D0%B5%D0%BD%20%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D1%8F%D0%BC%D0%B8).md)

**Reliability (Надёжности)**

[Circuit Breaker (Предохранитель)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Circuit%20Breaker%20(%D0%9F%D1%80%D0%B5%D0%B4%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C).md)

**Discovery (Обнаружение сервисов)**

[Self registation (Саморегистрация)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Self%20registation%20(%D0%A1%D0%B0%D0%BC%D0%BE%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F).md)

[Client side discovery (Обнаружение на стороне клиента)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Client%20side%20discovery%20(%D0%9E%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D0%BA%D0%BB%D0%B8%D0%B5.md)

[3rd party registration (Сторонняя регистрация)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/3rd%20party%20registration%20(%D0%A1%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%BD%D1%8F%D1%8F%20%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F).md)

[Server-side discovery (Обнаружение на стороне сервера)](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Server-side%20discovery%20(%D0%9E%D0%B1%D0%BD%D0%B0%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2.md)

**Транзакционный обмен сообщениями**

[**Transactional outbox (Публикация событий)**](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Transactional%20outbox%20(%D0%9F%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8%CC%86).md)

[**Polling publisher (Опрашивающий издатель)**](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Polling%20publisher%20(%D0%9E%D0%BF%D1%80%D0%B0%D1%88%D0%B8%D0%B2%D0%B0%D1%8E%D1%89%D0%B8%D0%B8%CC%86%20%D0%B8%D0%B7%D0%B4%D0%B0%D1%82%D0%B5%D0%BB%D1%8C).md)

[**Transaction log tailing (Отслеживание тразакционного журнала)**](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Transaction%20log%20tailing%20(%D0%9E%D1%82%D1%81%D0%BB%D0%B5%D0%B6%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D1%82%D1%80%D0%B0%D0%B7%D0%B0%D0%BA%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D0%BE.md)

[**API Gateway (API шлюз)**](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/API%20Gateway%20(API%20%D1%88%D0%BB%D1%8E%D0%B7).md)

[**Backends for Frontends (BFF)**](Interprocess%20communication%20(%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5/Backends%20for%20Frontends%20(BFF).md)