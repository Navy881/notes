# Backends for Frontends (BFF)

### Проблема

Одна из проблем API-шлюза состоит в нечетком разделении ответственности. Разные команды вносят свой вклад в общую кодовую базу. Команда API-шлюза от­ вечает за его эксплуатацию. Это не настолько плохо, как в SOA ESB, но размывание ответственности противоречит одному из принципов микросервисной архитектуры: «за компонент отвечает тот, кто его пишет».

### Решение

Решением этой проблемы является выделение API-шлюза для каждого клиента. Это шаблон проектирования BFF (backends for frontends — серверы для клиентов), который был предложен Филом Кальсадо (Phil Calado) ([philcalcado.com](http://philcalcado.com/)) и его кол­легами из SoundCloud. Каждый API-модуль превращается в отдельный API-шлюз, который разрабатывается и администрируется одной кли­ентской командой.

![Untitled](Backends%20for%20Frontends%20(BFF)/Untitled.png)

Команда публичного API владеет своим API-шлюзом и отвечает за его админи­стрирование, у мобильной команды — свой API-шлюз, администрированием кото­рого она занимается, и т. д. Теоретически разные API-шлюзы можно разрабатывать с помощью разных наборов технологий. 

**GraphQL**

Написание API-шлюза с интерфейсом REST API с хорошей поддержкой широ­кого спектра клиентов занимает много времени. В связи с этим вам стоит обратить внимание на графовый API-фреймворк GraphQL, который специально создан для эффективного извлечения данных. Суть таких фреймворков заключается в том, что API сервера имеет структуру графа. Графовая структура (схема) задает набор *узлов* (типов), имеющих *свойства* (поля) и связи с другими узлами. Чтобы извлечь данные, клиент выполняет запрос, который описывает необходимую ин­ формацию в виде узлов графа, их свойств и связей. В итоге клиент может извлечь нужные ему данные за одно обращение к API-шлюзу.

![Untitled](Backends%20for%20Frontends%20(BFF)/Untitled%201.png)

Технология графовых API имеет несколько важных преимуществ. 

- Позволяет клиенту контролировать возвращаемые данные.
- Позволяет создавать единый API, обладающий достаточной гибкостью для поддержки разного рода клиентов.
- Несмотря на гибкость API, она зна­чительно облегчает разработку. Это связано с тем, что для написания серверного кода используется фреймворк выполнения запросов, специально созданный для под­держки объединения и отображения API.

Технологии структурированных API

- Apollo GraphQL
- Netflix Falcor

Принципиальное преимущество технологии GraphQL — ее язык запросов, который дает клиенту невероятный контроль над возвращаемыми данными. Клиент отправ­ляет серверу документ, содержащий запрос. В простейшем случае в нем указаны название запроса, значения аргументов и поля объекта, который нужно вернуть.

### Преимущества

- Четкое разделения ответственности
- API-модули изолированы друг от друга, что повышает надежность.
- Это улучшает наблюдаемость, поскольку API-модули выполняются в разных процессах.
- Независимое масштабирование каждого API.
- Уменьшение времени запуска, из-за того что каждый отдельный API-шлюз становится более компактным и простым.

### Недостатки

- Возможное дублирование общей функциональности, такой как реализация граничных функций. В идеале все API-шлюзы должны использовать единый технологический стек. Команда API-шлюза выносит общие возможности в разделяемую библиотеку.