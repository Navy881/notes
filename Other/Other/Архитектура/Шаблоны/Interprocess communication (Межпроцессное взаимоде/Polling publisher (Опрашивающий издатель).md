# Polling publisher (Опрашивающий издатель)

### Проблема

Как опубликовать сообщения/события из таблицы OUTBOX в базе данных в брокер сообщений?

### Решение

Если приложение использует реляционную базу данных, сообщения, вставленные в таблицу OUTBOX, можно опубликовать очень простым способом: ретранслятору до­статочно запросить из таблицы неопубликованные записи. Таблица периодически опрашивается:

```sql
SELECT * FROM OUTBOX ORDERED BY ... ASC
```

Затем ретранслятор публикует эти сообщения брокеру, отправляя их по соот­ветствующим каналам. 

В конце он удаляет сообщения из таблицы OUTBOX:

```sql
BEGIN
DELETE FROM OUTBOX WHERE ID in (...)
COMMIT
```

![Untitled](Transactional%20outbox%20(%D0%9F%D1%83%D0%B1%D0%BB%D0%B8%D0%BA%D0%B0%D1%86%D0%B8%D1%8F%20%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B8%CC%86)/Untitled.png)

### Преимущества

- простой подход, который неплохо работает в неболь­ших масштабах.

### Недостатки

- частое обращение к БД может ока­заться затратным;
- можно использовать только с теми базами данных NoSQL, которые поддерживают соответствующие запросы. Это связано с тем, что вместо таблицы OUTBOX приложению приходится запрашивать бизнес-объекты, а это не всегда можно сделать эффективно.