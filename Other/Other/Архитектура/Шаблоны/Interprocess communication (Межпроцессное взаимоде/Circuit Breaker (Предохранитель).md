# Circuit Breaker (Предохранитель)

### Проблема

Каждый раз, когда сервис в распределенной системе делает синхронный запрос к другому сервису, возникает риск частичного отказа. 

### Решение

Шаблон предлагает создавать PRI-прокси, который в случае достижения определённого количества последовательных отказов начинает откланять все запросы, пока не исчетёч определеённое время.

![Untitled](Circuit%20Breaker%20(%D0%9F%D1%80%D0%B5%D0%B4%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C)/Untitled.png)

При проектировании сервисов необходимо позаботиться о том, чтобы частичный отказ не мог распространиться по всему приложению. Решение этой задачи состоит из двух частей.

- Вы должны использовать RPI-прокси наподобие, чтобы справляться с недоступными удаленными сервисами.
Этот подход сочетает в себе следующие механизмы.
    - *Сетевое время ожидания.* Никогда не блокируйтесь бессрочно, всегда отсчи­тывайте время ожидания запроса. Это гарантирует, что когда-нибудь ресурсы освободятся.
    - *Ограничение количества неудачных запросов от клиента к сервису.* Установите лимит максимального количества неудавшихся запросов, которые клиент может послать определенному сервису.
    - *Шаблон «Предохранитель».* Отслеживайте количество успешных и неудавшихся запросов. Если частота ошибок превысит некий порог, разомкните предохрани­тель, чтобы дальнейшие попытки сразу же завершались.
    
    Используйте библиотеки с реализацией RPI-прокси (Netflix Hystrix для JVM, Polly для .NET).
    

- Вам нужно решить, как восстановиться после отказа удаленного сервиса.
    - Простое возвращение ошибки своему клиенту.
    - Возвращение резервного значения значения по умолчанию, либо закэшированного ответа.
    - В случае использование API-шлюза возвращение данных только от доступных сервисов.
    
    ![Untitled](Circuit%20Breaker%20(%D0%9F%D1%80%D0%B5%D0%B4%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C)/Untitled%201.png)