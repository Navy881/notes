# Audit logging (Ведение журнала аудита)

### Проблема

Как понять поведение пользователей и приложения и устранить неполадки?

Цель ведения журнала аудита — запись всех действий пользователя. Журнал аудита обычно используется для помощи службе поддержки, соблюдения нормативно­ правовых норм и обнаружения подозрительной активности. Каждая запись в таком журнале содержит идентификатор пользователя, выполненное им действие и бизнес-объект(-ы). Приложения обычно хранят журналы аудита в базах данных.

### Решение

Запись действий пользователя в базу данных.

Записывает действия пользователя в базу данных, чтобы помочь службе поддержки, обеспечить соблюдение нормативно-правовых норм и обнаружить подозрительную активность.

Ведение журнала аудита можно реализовать несколькими разными способами.

- Добавить код ведения журнала аудита в бизнес-логику.
Самый простой вариант — внедрить код ведения журнала аудита в бизнес-логику вашего сервиса. Например, каждый метод сервиса может создавать новую запись и сохранять ее в базе данных. Недостаток этого подхода состоит в том, что он связывает код ведения журнала аудита и бизнес-логику, что осложняет обслужи­вание приложения. Еще один отрицательный аспект связан с повышенным риском возникновения ошибок, так как за написание кода для ведения журнала аудита от­вечает разработчик.
- Задействовать аспектно-ориентированное программирование.
Вы можете воспользоваться АОП-фреймворком, таким как Spring АОР, для создания так называемых *советов,* которые автоматически перехватывают вызов каждого метода внутри сервиса и со­храняют запись в журнал аудита. Это куда более надежный подход, поскольку он автоматически записывает все вызовы. Его основным недостатком является то, что совет имеет доступ только к названию метода и его аргументам, поэтому у вас мо­гут возникнуть проблемы с определением бизнес-объекта, на который направлено действие, и генерацией бизнес-ориентированной журнальной записи.
- Использовать порождение событий.
Реализация бизнес-логики с применением порождения событий. *Порождение событий* автоматиче­ски предоставляет журнал аудита для операций создания и обновления. При этом вам нужно записывать учетные данные пользователя в каждое событие. Одно из ограничений этого подхода связано с тем, что он не записывает запросы. Если ваш сервис должен создавать журнальные записи для запросов, следует выбрать другой вариант.

### Преимущества

- Обеспечивает запись действий пользователя.

### Недостатки

- Код аудита переплетается с бизнес-логикой, что делает бизнес-логику более сложной.